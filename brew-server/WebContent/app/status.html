<!DOCTYPE html>
<html>
<meta charset="utf-8"/>
<head>
<title>Brew Controller Status</title>
<link rel="stylesheet" type="text/css" href="../theme/main.css" />
<link rel="stylesheet" type="text/css" href="../theme/status.css" />
<link rel="stylesheet" type="text/css" href="../theme/menu.css" />
<script type="text/javascript" src="../scripts/Chart.bundle.js" ></script>
<script type="text/javascript" src="../scripts/chartLoader.js" ></script>
<script type="text/javascript" src="../scripts/refreshStatus.js" ></script>
<script type="text/javascript">

var contextPath = document.location.href;
var posStart = contextPath.indexOf("/",  contextPath.indexOf("/") + 2);
var posEnd = contextPath.indexOf("/", posStart + 1);
contextPath = contextPath.substring(posStart, posEnd);
if (contextPath.substring(0,4) == "/app") {
	contextPath = "";
}

var aktSubmenu;

function loadSubmenu(step) {
	var r = new XMLHttpRequest();
	r.open("GET", contextPath + "/v1/api/recipes/0/steps/" + step, true);
	r.onreadystatechange = function() {
		if (r.readyState != 4 || r.status != 200) {
			return;
		}
		var submenu = JSON.parse(r.responseText);
		var last = submenu.length-1;
		for (var i=0;i<=last; i++) {
			addSubmenuEntry(submenu[i], i==0, i<last);
		}
	};
	r.send();
}

function addSubmenuEntry(menuEntry, clearBeforeAdd, addArrow) {
	var submenu = document.getElementById("submenu");
	var html = clearBeforeAdd ? "" : submenu.innerHTML;
	html +="<span class=\"menu sub_menu";
	if (menuEntry.active) {
		html += " menu_selected";
	}
	if (menuEntry.finished) {
		html += " menu_finished";
	}
	html += "\">" + menuEntry.name + "</span>";
	if (addArrow) {
		html +="<img src=\"../theme/up.png\" class=\"down rotateimg180\"/>";
	}
	submenu.innerHTML = html;
}

///// tabs /////
function showTab(evt, tabName, tabClassName, tabmenuClassName) {
    // Declare all variables
    var i, tabcontent, tablinks;

    // Get all elements with class="tabcontent" and hide them
    tabcontent = document.getElementsByClassName(tabClassName);
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
    }

    // Get all elements with class="tablinks" and remove the class "active"
    tablinks = document.getElementsByClassName(tabmenuClassName);
    for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
    }

    // Show the current tab, and add an "active" class to the button that opened the tab
    document.getElementById(tabName).style.display = "block";
    evt.currentTarget.className += " active";
}

function overlay(mode) {
   if (mode == 'display') {
       if(document.getElementById("overlay") === null) {
           div = document.createElement("div");
           div.setAttribute('id', 'overlay');
           div.setAttribute('className', 'overlayBG');
           div.setAttribute('class', 'overlayBG');
           document.getElementsByTagName("body")[0].appendChild(div);
           document.getElementById("lightBox").style.display="block";
       }
   } else {
		var overlay = document.getElementById("overlay");
	   	if (overlay != null) {
       		document.getElementsByTagName("body")[0].removeChild(overlay);
       		document.getElementById("lightBox").style.display="none";
	   	}
   }
}

function init() {
	loadSubmenu("mashing");
	loadStatus();
	setInterval(loadStatus, 2500);
}

</script>
</head>
<body onload="init();">
	<table border ="0">
		<tr>
		<td valign="middle" align="center" colspan="3">
			<div class="menu main_menu">Rezept</div>
			<img src="../theme/left.png"  class="right rotateimg180" onclick=""/>
			<div class="menu_selected menu main_menu">Einmaischen</div>
			<img src="../theme/left.png"  class="right rotateimg180" onclick=""/>
			<div class="menu main_menu">Läutern</div>
			<img src="../theme/left.png"  class="right rotateimg180" onclick=""/>
			<div class="menu main_menu">Kochen</div>
			<img src="../theme/left.png"  class="right rotateimg180" onclick=""/>
			<div class="menu main_menu">Kühlen &amp; Anstellen</div>
		</td>
		</tr>
		<tr>
		<td valign="middle" align="center" colspan="3">
			<hr style="color:#d6d6d6"/>
		</td>
		</tr>
		<tr>
		<td align="center" id="submenu" rowspan="2">
		</td>
		<td align="center">
			<table class="status" border="0">
				<tr>
					<td></td>
					<td colspan="2" align="center"><span id="rotationSpeed"></span><br /></td>
					<td></td>
				</tr>
				<tr>
					<td></td>
					<td colspan="2" align="center">
						<img id="icon_stirrer" class="statusIcon" src=""/>
					</td>
					<td></td>
				</tr>
				<tr>
					<td></td>
					<td colspan="2" rowspan="2">
						<div class="potImage">
							<img src="../theme/pot.png" id="temperatureAvg_icon" onclick="" width="150" height="225"/>
							<span class="potTemp"><span id="avgTemp"></span></span>
						</div>
					</td>
					<td align="center">
						<img id="temperature1_icon" class="statusIcon" onclick="" src="../theme/thermometer.png" /><br />
						<div id="temperature1"></div>
					</td>
				</tr>
				<tr>
					<td align="center">
						<img id="temperature2_icon" class="statusIcon" onclick="" src="../theme/thermometer.png" /><br />
						<div id="temperature2"></div>
					</td>
					<td></td>
				</tr>
				<tr>
					<td></td>
					<td><img id="icon_heater_1" class="statusIcon" src="" /></td>
					<td><img id="icon_heater_2" class="statusIcon" src="" /></td>
					<td></td>
				</tr>
				<tr>
					<td></td>
					<td colspan="2" align="center"><span id="time"></span></td>
					<td></td>
				</tr>
			</table>
		</td>
		<td>
			<div class="tab">
			  <button class="tablinks" onclick="showTab(event, 'chartTab', 'tabcontent', 'tablinks')" id="clickChartTab">Chart</button>
			  <button class="tablinks" onclick="showTab(event, 'logTab', 'tabcontent', 'tablinks')" id="clickLogTab">Log</button>
			</div>
			
			<div id="chartTab" class="tabcontent">
				<canvas id="chartCanvas" width="500px" height="500px"></canvas>
			</div>
			
			<div id="logTab" class="tabcontent">
				<div  style="width:500px;height:500px">
			  		<h3>Brew-Log:</h3>
			  		<p>Was bisher geschah</p>
			  	</div> 
			</div>
			
		</td>
		</tr>
		<tr>
		<td colspan="2">
		</td>
		</tr>
	</table>
	<script type="text/javascript">
		document.getElementById("clickLogTab").click();
	</script>
	
	<div id="lightBox" style="display:none">
		<p id="actionSource"></p>
		<div id="showChart" class="menu sub_menu" onClick="performAction('showChart')">Chart<br/></div>
		<div id="switchON" class="menu sub_menu" onClick="performAction('switchOn')">ON<br/></div>
		<div id="switchOFF" class="menu sub_menu" onClick="performAction('switchOff')">OFF<br/></div>
	</div>
</body>
</html>